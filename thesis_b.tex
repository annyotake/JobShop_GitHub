\documentclass[a4paper,12pt,twoside]{jreport}
\usepackage[T1]{fontenc} % Use T1 encoding (8bit font encoding)
\usepackage{lmodern} % Use Latin Modern (LM) font
%\usepackage[dvips]{graphicx}
\usepackage[dvipdfmx]{graphicx}
\usepackage{url}
\usepackage{kit-is-b}
\usepackage{amsmath}
\usepackage{algorithm}
\usepackage{algorithmic}
\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\author{竹下　拓希}
\idnumber{22122031}
\deadline{2026}{2}{13} % 提出日{西暦年}{月}{日}
%% 長いタイトルで途中改行する場合，改行したい位置で
%% \coverbreak, \abstbreak, \\ のいずれかを使う．
%%   \coverbreak ：表紙でのみこの位置で改行
%%    \abstbreak ：概要でのみこの位置で改行
%%            \\ ：表紙・概要ともにこの位置で改行
%%【例】
%% \title{長い長いタイトル\coverbreak の改行位置\abstbreak に関する研究}
\title{作業者の希望に沿ってシフトを決定する \coverbreak\abstbreak ジョブショップスケジューリング}
%% 以下，指導教員名の前の数字は職名を表す（順序ではない）
%% 1:教授，2:准教授，3:講師，4:助教，5:助手，
%% 6:特任教授，7:特任准教授，8:特任講師，9:特任助教，
%% 10:特定教授，11:特定准教授，12:特定講師，13:特定助教
\advisor{2}{飯間　等} % 指導教員（工繊一郎教授）
%\secondadvisor{2}{情報　次郎} % （必要ならば）指導教員（情報次郎准教授）
%\thirdadvisor{4}{情報　三郎} % （必要ならば）指導教員（情報三郎助教）
\begin{document}
\maketitle

%%
%% 和文概要
%%
\begin{abstract}
	実際の生産現場における生産システムは複雑であるため，
	そのシステムにおける最適なスケジュールを求めることや
	それに関わる作業者のシフトを最適に割り当てることは難しい．
	加えて，働き方の多様化などにより，
	作業者は限られたシフトのみを希望することが多くなっており，
	そのような要求を考慮するスケジューリングを行う必要がある．
	このようなスケジューリングを最適化問題として定式化した問題は，
	フレキシブルジョブショップスケジューリング問題（Flexible Job-shop Scheduling Problem, FJSP）
	と総称されている．
	本研究では，実際の生産現場に近い問題設定となるように，
	作業間の順序制約，ジョブの優先度，資源制約，機械および作業者の柔軟性，
	メンテナンスなどの資源の利用不可期間といった制約を考慮したFJSPを扱う．
	先行研究では，このFJSPに対する解法として，
	Improved two-stage Differential Evolution algorithm（IDE）が提案されており，
	この解法により，優先度の低いジョブ（LPジョブ）の納期からの遅延日数を最小化するとともに，
  必要であれば，作業者に残業を割り当てつつ，
	優先度の高いジョブ（HPジョブ）を納期内に完了させる．
	しかし，この解法では作業者に残業を割り当てるときに，
	作業者の希望を考慮しておらず，
  作業者はどのシフトを割り当てられても，そのシフトで作業をしなければならない．
	本研究では，このIDEを改良して，
	作業者が希望する残業時間に基づいて，
	作業者の希望に沿うよう残業を割り当てる解法を提案する．
	実際の生産現場を調査して得たデータを基に生成されたインスタンスと
	大規模のインスタンスの
	２つの先行研究で用いられているインスタンスに対してスケジューリングを行い，
	先行研究との比較をしつつ，提案解法の有効性を検証した．
	その結果，提案解法は先行研究における解法IDEと大きな差がない実行時間で，
	作業者の希望に沿うよう残業を割り当てつつ，
	先行研究と同様に，
	LPジョブの納期からの遅延日数を最小化するとともに，
	HPジョブを納期内に完了させることができていることが確認された．
\end{abstract}

\begin{contents}
\tableofcontents % 目次の作成
%\nchapter{記号・略語一覧} % 必要ならば
%% ここに記号説明を書く
\end{contents}

\chapter{緒言}
生産技術の高度化と複合化により，生産システムはより複雑となり，
そのシステムにおける最適なスケジュールを求めることや 
それに関わる作業者のシフトを最適に割り当てることが難しくなっている．
このような計画を立てるために，組合せ最適化問題として
定式化するスケジューリング問題が取り上げられる．
この問題は電子産業\cite{Y221}や航空宇宙分野\cite{Y229}などの
様々な分野で応用されており，
NP困難問題\cite{Y765}とされている．
このスケジューリング問題を解くことで，生産現場において，
機械などの資源に対し，ジョブ（仕事）を最も効率よく割り当てるために，
どのジョブをどの時間・順番で行うべきかを求めることができる．
スケジューリング問題には様々な種類があるが，その中でも
フレキシブルジョブショップスケジューリング問題（Flexible Job-shop Scheduling Problem, FJSP）\cite{Y165}は
各工程での機械が複数台となっている複雑な問題である．
また，このFJSPに対して，作業間の順序制約\cite{Y219}\cite{Y201}，
ジョブの優先度\cite{Y178}，資源制約\cite{Y070}\cite{Y162}，
機械および作業者の柔軟性\cite{Y182}\cite{Y217}，
メンテナンスなどの資源の利用不可期間\cite{Y163}\cite{Y2212}など，
様々な制約が考慮される研究が行われている．
そして，作業者のシフトを調整する研究もいくつかある\cite{Y2212}\cite{Y225}．

また，関連研究\cite{Y241}では，
作業間の順序制約，ジョブの優先度，資源制約，機械および作業者の柔軟性， 
メンテナンスなどの資源の利用不可期間といった制約を考慮したFJSPにおいて，
機械と作業者の２つの資源で構成され，
各作業が機械と作業者を必要とする作業と作業者のみを必要とする作業で行われる生産現場を対象とし，
実際の生産現場に近い問題設定となっている．
そして，ジョブを優先度の高いジョブ（HPジョブ）と優先度の低いジョブ（LPジョブ）に分け，
HPジョブは納期内に完了させ，
LPジョブは納期からの遅延日数を最小化している．
作業者のシフトのスケジューリングでは，
HPジョブが納期内に完了しない場合の作業者の残業時間を最小化することを目的としている．
また，この問題に対する解法として，
差分進化（Diffferential Evolution, DE）\cite{Y214}を用いて，
２段階でスケジューリングを行う解法を提案している．
しかし，この研究では作業者の希望を考慮してスケジューリングを行っておらず，
作業者はどのシフトを割り当てられても，そのシフトで作業をしなければならない．
現在は働き方の多様化などで，
作業者は限られたシフトのみを希望することが多くなっており，
そのような要求を考慮するスケジューリングが求められている．

本研究では，上記の先行研究を基に，
作業者の希望も考慮したシフトと生産スケジュールを作成する最適化法を提案する．
先行研究の２段階でスケジューリングを行う解法では，
１段階目で得たスケジュールにおいて
HPジョブが納期内に完了していない場合に，
２段階目でHPジョブが納期内に完了することを目指しつつ，
作業者の残業時間を最小化しており，
本研究ではこの段階で作業者の希望も考慮する．

本報告書の構成について述べる．
第２章では，本研究で用いるDEを，
第３章では，先行研究を概観する．
第４章では，本研究で対象とするFJSPを定義する．
第５章では，第４章で定義した問題に対する提案解法について説明する．
第６章では，第５章での解法を問題例に適用した結果とその考察について述べる．
第７章では，本研究の結論とそれを踏まえた今後の展望について述べる．

\chapter{差分進化}
\section{概要}
DEは1995年にStornとPriceによって提案された
実数空間における最適化アルゴリズムであり\cite{Y214}，
遺伝的アルゴリズム（Genetic Algorithm, GA）などの
進化的アルゴリズム（Evolutionary Algorithm, EA）の１つである．
DEは集団サイズ$NP$，スケーリングファクター$SF$，交叉率$CR$の
３つのパラメータを用いて，
突然変異，交叉，選択の３つの操作を行う
比較的単純で効率的なアルゴリズムとなっている．
そのため，様々な最適化問題に適用されており，
スケジューリングに関する研究においても 
DEを用いた解法が利用されている\cite{Y2012}\cite{Y122}\cite{Y226}\cite{Y213}\cite{Y971}．

DEにはDE/rand/1/binやDE/rand to best/1/bin，DE/best/2/binなどの
いくつかの形式があり，各形式では突然変異の手法が異なる．
これらの形式はDE/$base$/$num$/$cross$という記法で表現される．
$base$は基本ベクトルとなる親の選択方法を指定する．
$num$は基本ベクトルを変異させるための差分ベクトルの個数を指定する．
$cross$は子を生成するために使用する交叉方法を指定する．
本研究ではDE/rand to best/1/binを用いる．

\section{アルゴリズム}
本研究で用いるDE/rand to best/1/binのアルゴリズムについて述べる．

\begin{description}
	\item[Step0] 初期化：$NP$個の初期個体$x_k (k = 1,2,\cdots,NP)$を探索空間$S$内に生成し，
	             個体群$P = \{x_1,x_2,\cdots,x_{NP}\}$を構成する．
							 世代を$G = 1$とする．
	\item[Step1] 突然変異：世代$G$の個体群$P$における各親個体$x^G_k$に対して，
	             個体群$P$から２個体$x^G_{r1}$, $x^G_{r2}$を$x^G_k$および互いに重複しないようにランダムに選択する．
							 また，最良個体$x^G_{best}$を選択する．
							 そして，基本ベクトル$x^G_k$および差分ベクトル$x^G_{best}-x^G_k$, $x^G_{r1}-x^G_{r2}$から変異ベクトル$v^{G+1}_k$を
							 以下の式(2.1)に基づいて生成する．
							 \begin{equation}
							  v^{G+1}_k = x^G_k + SF(x^G_{best} - x^G_k) + SF(x^G_{r1}-x^G_{r2})
							 \end{equation}
	\item[Step2] 交叉：変異ベクトル$v^{G+1}_k$と親個体$x^G_k$を交叉し，子個体$u^{G+1}_k$を生成する．
	             このとき，以下の式(2.2)に基づいて交叉を行う．
							 \begin{equation}
							  u^{G+1}_{kl} = 
							  \begin{cases}
							   v^{G+1}_{kl} & \text{if $rand \leq CR$} \\
								 x^G_{kl}     & \text{otherwise}
							  \end{cases}
							 \end{equation}
							 $u^{G+1}_{kl}$，$v^{G+1}_{kl}$，$x^G_{kl}$は
							 それぞれ$u^{G+1}_k$，$v^{G+1}_k$，$x^G_k$の
							 $l$番目の要素である．
							 また，$rand$は０から１までの乱数である．
	\item[Step3] 選択：子個体$u^{G+1}_k$を評価し，
	             子個体$u^{G+1}_k$が親個体$x^G_k$よりも良い場合，
							 次世代$G\!+\!1$における個体$x^{G+1}_k$を子個体$u^{G+1}_k$とする．
							 そうでない場合，個体$x^{G+1}_k$を親個体$x^G_k$のままにする．
	\item[Step4] 終了判定：終了条件を満たしている場合，アルゴリズムを終了する．
	             満たしていない場合，Step1に戻る．
\end{description}


\chapter{先行研究}
本研究に関連する先行研究\cite{Y241}では，１章で述べたとおり，
機械と作業者の２つの資源で構成され，
各作業が機械と作業者を必要とする作業と作業者のみを必要とする作業で行われる生産現場を対象とし，
作業間の順序制約，資源制約，機械および作業者の柔軟性，
メンテナンスなどの資源の利用不可期間といった制約を考慮したFJSPを扱う．
また，このFJSPのジョブには優先度が設けられており，
各ジョブが高優先度のHPジョブと低優先度のLPジョブに分けられている．
このFJSPに対する解法として，
Improved two-stage Differential Evolution algorithm（IDE）が提案されており，
この解法により，LPジョブの納期からの遅延日数を最小化するとともに，
HPジョブを納期内に完了させ，
作業者のシフトはHPジョブが納期内に完了しない場合の
作業者の残業時間を最小化するようスケジューリングを行うことが可能である．
また，この解法は計算効率を向上させるため，２段階で構成されている．

第１段階では，全作業者の１日のシフトを８時間（標準シフト）とし，
生産システムにおけるスケジューリングに焦点を当てる．
このスケジューリングでは，
HPジョブおよびLPジョブが納期内に完了しない可能性があるが，
作業者は残業を行わないものとする．
HPジョブが納期内に完了しない場合は
その納期からの遅延期間にペナルティ係数$H$を乗じた数値を目的関数$F$に加える．
また，このスケジューリングではDEが用いられており，
このDEによって最良個体群（最良のスケジュール）を得る．

第２段階では，第１段階で得た個体群（スケジュール）において，
作業者の標準シフトでは
HPジョブが納期内に完了しない場合，
HPジョブが納期内に完了するよう作業者のシフトを調整する．
このとき，LPジョブを担当する作業者に不要な残業が発生する可能性があるため，
LPジョブを担当する作業者が残業を行う場合，
その残業日数にペナルティ係数$H$を乗じた数値を目的関数に$F$に加える．

このIDEに対して行った実験では，他の解法と比較した結果が報告されている．
ここでIDEと比較した解法は，DE，GA，
粒子群最適化（Particle Swarm Optimization, PSO），
Jayaアルゴリズムである．
実行時間に関しては，IDE以外の解法が優れているが，
目的関数値に関しては，IDEによって得られた値の方が小さいことがほとんどであり，
IDEが優れていることが報告されている．

しかし，この研究では作業者の希望を考慮してスケジューリングを行っておらず，
作業者はどのシフトを割り当てられても，そのシフトで作業をしなければならない．
現在は働き方の多様化などで，
作業者は限られたシフトのみを希望することが多くなっており，
そのような要求を考慮するスケジューリングが求められている．
次章以降でこのようなスケジューリングを行うための問題設定と
その解法について説明する．

\chapter{問題設定}
本研究で対象とするFJSPでは，
生産現場で行うジョブの集合を$J$，
作業の集合を$O$とする．
各ジョブはいくつかの作業で構成されており，
これらの作業は所定の順番で実行しなければならない．
また，各ジョブに優先度が設けられており，
高優先度のHPジョブと低優先度のLPジョブに分けられ，
HPジョブは納期内に完了しなければならない．
一方，LPジョブは納期内に完了しないことを許容する．
資源は機械と作業者の２つであり，
機械の集合を$M$，作業者の集合を$W$とする．
各作業は，機械と作業者の両方または作業者のみによって実行される．

次に，制約を以下に示す．

(1) すべての機械は必ず１人の作業者を必要とする．

(2) 各作業はそれに対応できる資源の集合から選択される資源によってのみ処理されることができ，
    また各資源は同時に１つの作業しか処理できない．

(3) ジョブを分割したり，他のジョブと統合することは考慮しない．
    また，すべてのジョブの開始可能時刻と完了予定時刻（納期）はあらかじめ定められている．

(4) 各作業はその直前の作業が完了するまで開始できない．
    また，各作業の作業時間は準備時間と実行時間で構成されている．

(5) １つの作業を複数の機械や作業者によって処理することはできない．
    また，作業中に資源が利用不可となった場合，
    その作業は資源が再び利用可能となるまで中断される．

(7) 時刻0は月曜日の0時とする．
    また，時刻は分単位で扱う．

(8) 作業者の標準シフトは8時～17時の9時間とする．
    勤務時間は休憩時間などの作業をしていない時間も含む．

本論文で特に焦点としているシフトについて説明する．
シフトは標準シフト以外に，平日の残業シフトと休日シフトがあり，
作業者ごとに勤務してよい希望の時間帯が与えられている．
標準シフト以外は残業や休日出勤となるので，
できるだけ残業・休日シフトを使わないようにする．
一方，もし希望の残業・休日シフトだけでは
HPジョブが納期内に完了しないなら，さらにシフトを増やして対応する．
このとき，休日にはシフトを増やさず，平日の残業時間を増やして対応させる．
この希望していない残業増加時間はできるだけ削減させるようにする．

表4.1と表4.2で示した用語を用いて，先行研究を基に，
本研究で対象とするFJSPを定義する．
このFJSPを基に，
作業者の希望を考慮しつつ，残業時間を最小化したシフトと，
HPジョブを納期内に完了させ，
LPジョブの納期からの遅延日数を最小化した生産スケジュールを作成する．
目的関数$F$は以下の式(4.1)のように表され，
LPジョブの納期からの遅延日数と
作業者の残業時間を最小化しつつ，
作業者の希望に沿ったシフトを決定することを目的とする．
目的関数$F$の第3項で，
シフトが作業者の希望に沿っていない場合に
ペナルティ係数$H$を乗じた数値を目的関数$F$に加える．
また，式(4.2)の$t^e_j$はジョブ$j$における残業時間を表す．

\begin{equation}
	\begin{split}
	  \min F &= \sum_{j|P_j = LP} \max \left[0, \left( \left\lceil\frac{\max\limits_i(pT_{ji})}{1440}\right\rceil - \left\lceil\frac{E_j}{1440}\right\rceil \right)\right] \\
	         &\quad + \sum_{j|P_j = HP} \max \left[0, \left(\left\lceil\frac{E_j}{1440}\right\rceil - \left\lceil\frac{\max\limits_i(pT_{ji})}{1440}\right\rceil \right)\right] \cdot \left.\frac{E_j - \max\limits_i(pT_{ji})}{t^e_j} \right|_{t^e_j > 0} \\
			     &\quad + \sum_w{\sum_d \max \left[0, \left( wt^w_d - \sigma - de^w_d + ds^w_d \right) \right]} \cdot H
	\end{split}
\end{equation}

\begin{equation}
	t^e_j = \sum_i{\sum_w{ \left( \sum_{d \in D_{ji} \cap (D \setminus HD)}{x^w_{ji} \cdot \left( wt^w_d - \sigma \right) + \sum_{d \in D_{ji} \cap HD}{x^w_{ji} \cdot wt^w_d}} \right) }} (\forall j)
\end{equation}

\begin{equation}
	D_{ji} = \left\{\left\lceil\frac{sT_{ji}}{1440}\right\rceil, \cdots ,\left\lceil\frac{pT_{ji}}{1440}\right\rceil\right\}
\end{equation}

制約条件(4.4)は，すべてのLPジョブは残業が必要でないことを表す．
制約条件(4.5)は，すべてのHPジョブは納期内に完了しなければならないことを表す．
制約条件(4.6)は，各HPジョブの残業時間はその納期内に完了できる場合の余った時間以上でなければならないことを表す．
制約条件(4.7)は，各ジョブの開始時刻はその開始可能時刻以降でなければならないことを表す．
制約条件(4.8)は，集合$R^{\tau}_{ji}$の定義を示す．
制約条件(4.9)は，すべての作業は複数の機械または作業者によって処理されることはできないことを表す．
制約条件(4.10)と(4.11)は，各作業の準備時間および実行時間に関する制約であり，
                        作業の準備中または実行中に資源が利用不可となった場合，
												その期間も考慮することが必要であることを表す．
制約条件(4.12)は，すべての作業の準備開始時刻，準備完了時刻，実行完了時刻は
                 作業者の勤務時間および機械の利用可能期間内でのみ定めることができ，
								 それ以外の期間で定めることはできないことを表す．
制約条件(4.13)は，各ジョブにおける作業を処理する順番はあらかじめ定められていることを表す．
制約条件(4.14)は，すべての機械と作業者は同時に２つ以上の作業を処理することはできないことを表す．
制約条件(4.15)は，平日の残業時間が深夜０時までであることを表す．
制約条件(4.16)は，休日の残業時間は希望している時間内でなければならないことを表す．
                 これより，休日に対しては式(4.1)の目的関数$F$の第3項は必ず0となる．
最後に，
制約条件(4.17)は，$x^m_{ji}, x^w_{ji}, y^m_{j^{\prime}i^{\prime}ji}, y^w_{j^{\prime}i^{\prime}ji}$は
                 いずれも2値変数であることを表す．

\begin{equation}
  \text{subject to}　　　　　　t^e_j = 0, \forall j \in \{j|P_j = LP\}　　　　　　　　
\end{equation}
\begin{equation}
	\max_i(pT_{ji}) \leq E_j, \forall j \in \{j|P_j = HP\}
\end{equation}
\begin{equation}
	t^e_j \geq E_j - \max_i(pT_{ji}), \forall j \in \{j|P_j = HP\}
\end{equation}
\begin{equation}
	\min_i(sT_{ji}) \geq B_j, \forall j \in J
\end{equation}
\begin{equation}
	\begin{split}
	 R^{\tau}_{ji} = 
	 &
	 \begin{cases}
		 \left\{(m,w)|pt^{mw}_{ji} > 0\right\} & \text{if $\tau = 1$} \\
		 \left\{w|pt^w_{ji} > 0\right\}        & \text{if $\tau = 0$}
	 \end{cases} \\[-10pt]
	 & \forall i \in I, j \in J, m \in M, w \in W
  \end{split}
\end{equation}
\begin{equation}
	\begin{split}
	 &
	 \begin{cases}
		 \sum\limits_m x^m_{ji} = 1, \sum\limits_w x^w_{ji} = 1, (m,w) \in R^{\tau}_{ji} & \text{if $\tau = 1$} \\
		 \sum\limits_w x^w_{ji} = 1, w \in R^{\tau}_{ji} & \text{if $\tau = 0$}
	 \end{cases} \\[-10pt]
	 & 　　　　　　　\forall i \in I, j \in J
  \end{split}
\end{equation}
\begin{equation}
	\begin{split}
	 &
	 \begin{cases}
		 cT_{ji} \geq sT_{ji} + \frac{st^{mw}_{ji} \cdot (x^m_{ji} + x^w_{ji})}{2} + \sum\limits^{k_2}\limits_{k=k_1} (E_{wk} - B_{wk}) & \text{if $\tau = 1, sT_{ji} \leq B_{wk_1}, cT_{ji} \geq E_{wk_2}$} \\
		 cT_{ji} \geq sT_{ji} + \frac{st^{mw}_{ji} \cdot (x^m_{ji} + x^w_{ji})}{2} + \sum\limits^{k_4}\limits_{k=k_3} (E_{mk} - B_{mk}) & \text{if $\tau = 1, sT_{ji} \leq B_{mk_3}, cT_{ji} \geq E_{mk_4}$} \\
		 cT_{ji} \geq sT_{ji} + st^{w}_{ji} \cdot x^w_{ji} + \sum\limits^{k_2}\limits_{k=k_1} (E_{wk} - B_{wk})                         & \text{if $\tau = 0, sT_{ji} \leq B_{wk_1}, cT_{ji} \geq E_{wk_2}$}
	 \end{cases} \\[-10pt]
	 & 　　　　　　　　　　　　　\forall i \in I, j \in J, m \in M, w \in W \\[-10pt]
	 & 　　　　　　　　　　　　　k_1 \leq k_2 \in K_w, k_3 \leq k_4 \in K_m
  \end{split}
\end{equation}
\begin{equation}
	\begin{split}
	 &
	 \begin{cases}
		 pT_{ji} \geq cT_{ji} + \frac{pt^{mw}_{ji} \cdot (x^m_{ji} + x^w_{ji})}{2} + \sum\limits^{k_2}\limits_{k=k_1} (E_{wk} - B_{wk}) & \text{if $\tau = 1, cT_{ji} \leq B_{wk_1}, pT_{ji} \geq E_{wk_2}$} \\
		 pT_{ji} \geq cT_{ji} + \frac{pt^{mw}_{ji} \cdot (x^m_{ji} + x^w_{ji})}{2} + \sum\limits^{k_4}\limits_{k=k_3} (E_{mk} - B_{mk}) & \text{if $\tau = 1, cT_{ji} \leq B_{mk_3}, pT_{ji} \geq E_{mk_4}$} \\
		 pT_{ji} \geq cT_{ji} + pt^{w}_{ji} \cdot x^w_{ji} + \sum\limits^{k_2}\limits_{k=k_1} (E_{wk} - B_{wk})                         & \text{if $\tau = 0, cT_{ji} \leq B_{wk_1}, pT_{ji} \geq E_{wk_2}$}
	 \end{cases} \\[-10pt]
	 & 　　　　　　　　　　　　　\forall i \in I, j \in J, m \in M, w \in W \\[-10pt]
	 & 　　　　　　　　　　　　　k_1 \leq k_2 \in K_w, k_3 \leq k_4 \in K_m
  \end{split}
\end{equation}
\begin{equation}
	\begin{split}
	 &
	 \begin{cases}
		 sT_{ji}, cT_{ji}, pT_{ji} \notin [B_{mk_1}, E_{mk_1}] & \text{if $x^m_{ji} = 1$} \\
		 sT_{ji}, cT_{ji}, pT_{ji} \notin [B_{wk_2}, E_{wk_2}] & \text{if $x^w_{ji} = 1$} \\
	 \end{cases} \\[-10pt]
	 & \forall i \in I, j \in J, m \in M, w \in W, k_1 \in K_m, k_2 \in K_w
  \end{split}
\end{equation}
\begin{equation}
	sT_{j(i+1)} \geq pT_{ji}, \forall i,i+1 \in I, j \in J
\end{equation}
\begin{equation}
	\begin{split}
	 &
	 \begin{cases}
		 sT_{j^{\prime}i^{\prime}} \geq pT_{ji} - H \cdot (2 - x^m_{ji}- x^m_{j^{\prime}i^{\prime}} + y^m_{j^{\prime}i^{\prime}ji}) \\ 
		 sT_{ji} \geq pT_{j^{\prime}i^{\prime}} - H \cdot (3 - x^m_{ji}- x^m_{j^{\prime}i^{\prime}} - y^m_{j^{\prime}i^{\prime}ji})
	 \end{cases}
	 \text{if $\tau = 1$} \\
	 &
	 \begin{cases}
		 sT_{j^{\prime}i^{\prime}} \geq pT_{ji} - H \cdot (2 - x^w_{ji}- x^w_{j^{\prime}i^{\prime}} + y^w_{j^{\prime}i^{\prime}ji}) \\ 
		 sT_{ji} \geq pT_{j^{\prime}i^{\prime}} - H \cdot (3 - x^w_{ji}- x^w_{j^{\prime}i^{\prime}} - y^w_{j^{\prime}i^{\prime}ji})
	 \end{cases}
	 , \tau \in \{0, 1\} 
	 \\[-10pt]
	 & \forall i,i^{\prime} \in I, j,j^{\prime} \in J, m \in M, w \in W, O_{j^{\prime}i^{\prime}} \ne O_{ji}
  \end{split}
\end{equation}
\begin{equation}
	wt^w_d \leq 960　\text{,if $\forall w,d \in D \setminus HD$}
\end{equation}	
\begin{equation}
	wt^w_d = de^w_d - ds^w_d　\text{,if $\forall w,d \in HD$}
\end{equation}	
\begin{equation}
	x^m_{ji}, x^w_{ji}, y^m_{jij^{\prime}i^{\prime}}, y^w_{jij^{\prime}i^{\prime}} \in \{0, 1\}, \forall i,i^{\prime} \in I, j,j^{\prime} \in J, m \in M, w \in W
\end{equation}

\begin{table}[htb]
\centering
  \caption{各用語の意味（１）}
  \begin{tabular}{ll}  \hline
    用語 & 意味\\ \hline
    $j$ & ジョブの番号　$j \in J = \{1,2,\cdots,N_j\}$であり，$N_j$はジョブの数を表す．\\ \hline
		$i$ & 各ジョブにおける作業の番号　$i \in I = \{1,2,\cdots,N_{ji}\}$であり，\\
		    & $N_{ji}$はジョブ$j$の作業の数を表す．\\ \hline
		$w$ & 作業者の番号　$w \in W = \{1,2,\cdots,N_w\}$であり，\\
		    & $N_w$は作業者の人数を表す．\\ \hline
		$m$ & 機械の番号　$m \in M = \{1,2,\cdots,N_m\}$であり，\\
		    & $N_m$は機械の人数を表す．\\ \hline
		$d$ & 日付　$d \in D = \{1,2,\cdots,N_d\}$であり，\\
		    & $N_d$は日数を表す．\\ \hline
		$HD$ & 休日の集合　$d \in HD$であるとき，日付$d$は休日である．\\ \hline 
		$wt^w_d$ & 作業者$w$の日付$d$における勤務時間　シフトによって変わる． \\ \hline
		$\sigma$ & 標準シフトの分数　$\sigma = 9 \times 60 = 540$（分）とする． \\ \hline
		$ds^w_d$ & 日付$d$における作業者$w$が希望する残業開始時刻 \\ \hline
		$de^w_d$ & 日付$d$における作業者$w$が希望する残業終了時刻 \\ \hline
		$\tau$ & 作業の種類　$\tau \in \{0, 1\}$であり，\\
		       & $\tau = 0$の場合，作業者のみを必要とする作業を，\\
					 & $\tau = 1$の場合，機械と作業者を必要とする作業を表す．\\ \hline
		$H$ & ペナルティ係数　$H = 10^4$とする．\\ \hline
		$O_{ji}$ & ジョブ$j$の作業$i$ \\ \hline
		$R^{\tau}_{ji}$ & 作業$O_{ji}$に対応できる資源の集合 \\ \hline
		$B_j$ & ジョブ$j$の開始可能時刻 \\ \hline
		$E_j$ & ジョブ$j$の完了予定時刻（納期） \\ \hline
		$P_j$ & ジョブ$j$の優先度　$P_j \in \{HP, LP\}$であり，\\
		      & $HP$は優先度の高いジョブを，$LP$は優先度の低いジョブを表す．\\ \hline
  \end{tabular}
\end{table}

\begin{table}[htb]
\centering
  \caption{各用語の意味（２）}
  \begin{tabular}{ll}  \hline
    用語 & 意味\\ \hline
		$[B_{mk}, E_{mk}]$ & 機械$m$の利用不可期間　$k \in K_m = \{1,2,\cdots,N^k_m\}$であり，\\
		                   & $N^k_m$は機械$m$の利用不可期間の数を表す．\\ \hline
		$[B_{wk}, E_{wk}]$ & 作業者$w$が作業できない期間 \\
		                   & $k \in K_w = \{1,2,\cdots,N^k_w\}$であり，\\
		                   & $N^k_w$は作業者$w$が作業できない期間の数を表す．\\ \hline
		$st^{mw}_{ji}$ & $\tau = 1$の場合において，作業者$w$が機械$m$によって，\\
		               & 作業$O_{ji}$を実行するときの準備時間 \\ \hline
		$st^w_{ji}$ & $\tau = 0$の場合において，作業者$w$が作業$O_{ji}$を実行するときの準備時間 \\ \hline
		$pt^{mw}_{ji}$ & $\tau = 1$の場合において，作業者$w$が機械$m$によって，\\
		               & 作業$O_{ji}$を実行するときの実行時間 \\ \hline
		$pt^w_{ji}$ & $\tau = 0$の場合において，作業者$w$が作業$O_{ji}$を実行するときの実行時間 \\ \hline
		$sT_{ji}$ & 作業$O_{ji}$の準備開始時刻 \\ \hline
		$cT_{ji}$ & 作業$O_{ji}$の準備完了時刻 \\ \hline
		$pT_{ji}$ & 作業$O_{ji}$の実行完了時刻 \\ \hline
		$x^m_{ji}$ & $\tau = 1$の場合において，作業$O_{ji}$が機械$m$によって実行される場合，$x^m_{ji} = 1$，\\
		           & そうでない場合，$x^m_{ji} = 0$ \\ \hline
		$y^m_{jij^{\prime}i^{\prime}}$ & $\tau = 1$の場合において，作業$O_{ji}$が機械$m$によって実行されることが，\\
		                               & 作業$O_{j^{\prime}i^{\prime}}$よりも先の時刻となっている場合，$x^m_{ji} = 1$，\\
		                               & そうでない場合，$x^m_{ji} = 0$ \\ \hline
	  $x^w_{ji}$ & 作業者$w$が作業$O_{ji}$を実行する場合，$x^w_{ji} = 1$，\\
		           & そうでない場合，$x^w_{ji} = 0$ \\ \hline
		$y^w_{jij^{\prime}i^{\prime}}$ & 作業者$w$が作業$O_{ji}$を実行することが，\\
		                               & 作業$O_{j^{\prime}i^{\prime}}$よりも先の時刻となっている場合，$x^w_{ji} = 1$，\\
		                               & そうでない場合，$x^w_{ji} = 0$ \\ \hline
  \end{tabular}
\end{table}

\chapter{提案解法}
\section{概要}
本章では，第３章に述べた先行研究におけるIDEを基にして
第４章で定義した問題に対する最適化法について説明する．
この最適化法は２段階でスケジューリングを行い，
作業者の希望を考慮しつつ，残業時間を最小化したシフトと，
HPジョブを納期内に完了させ，
LPジョブの納期からの遅延日数を最小化した生産スケジュールを作成する．

第１段階は，IDEと同じ方法で
スケジューリングを行う．
ここでは全作業者の１日のシフトを
標準シフトの９時間（休憩時間などの作業をしていない時間も含む）とし，
作業者は残業を行わないものとする．
この条件下で，DEを用いて
作業間の資源を割り当てる最適な順番と
各作業に割り当てる最適な資源を求める．
このとき，HPジョブが納期内に完了しない場合は
その納期からの遅延期間にペナルティ係数$H$を乗じた数値を目的関数$F$に加える．
そして，DEを適用して目的関数値が良い個体群を得る．
ここでのDEでは，DE/rand to best/1/binのアルゴリズムを用いるが，
第２章で説明したアルゴリズムの交叉とは異なり，
以下の式(5.1)に基づいて交叉を行う．
\begin{equation}
  u^{G+1}_{kl} = 
	\begin{cases}
		v^{G+1}_{kl} & \text{if $rand \leq CR_k = CR + \dfrac{\pi_k - \pi_{best}}{\pi_{worst} - \pi_{best}}$} \\
		x^G_{kl}     & \text{otherwise}
	\end{cases}
\end{equation}
$\pi_k$は個体$x^G_k$の目的関数値，
$\pi_{best}$および$\pi_{worst}$は
それぞれ個体群における最良個体および最悪個体の目的関数値である．
よって，交叉率$CR$は各個体ごとに異なり，
個体の目的関数値が大きいほど交叉率$CR$は大きくなり，
個体の目的関数値が小さいほど交叉率$CR$は小さくなる．

第２段階では，第１段階で得られた目的関数値が最良である個体群において，
HPジョブが納期内に完了しない場合，
HPジョブが納期内に完了するよう作業者に残業を割り当てる．
このとき，残業時間を最小化しつつ，
あらかじめ定められている作業者が希望する残業時間に基づいて，
作業者の希望に沿うよう残業を割り当てる．
また，LPジョブを担当する作業者に残業が割り当てられた場合，
その残業はできるだけ削減すべきであるため，
その残業日数にペナルティ係数$H$を乗じた数値を目的関数に$F$に加える．
よって，目的関数$F$は式(5.1)の目的関数$F^{\prime}$に変更され，
第１段階・第２段階でこの目的関数$F^{\prime}$を用いられ，
この目的関数$F^{\prime}$の値を最小にすることを目的とする．
\begin{equation}
	\begin{split}
	  F^{\prime} &= \sum_{j|P_j = LP} \max \left[0, \left( \left\lceil\frac{\max\limits_i(pT_{ji})}{1440}\right\rceil - \left\lceil\frac{E_j}{1440}\right\rceil \right)\right] \\
	             &\quad + \sum_{j|P_j = HP} \max \left[0, \left(\left\lceil\frac{E_j}{1440}\right\rceil - \left\lceil\frac{\max\limits_i(pT_{ji})}{1440}\right\rceil \right)\right] \cdot \left.\frac{E_j - \max\limits_i(pT_{ji})}{t^e_j} \right|_{t^e_j > 0} \\
			         &\quad + \sum_w{\sum_d \max \left[0, \left( wt^w_d - \sigma - de^w_d + ds^w_d \right) \right]} \cdot H \\
		           &\quad + \sum_{j|P_j = HP} \max \left[0, \left( \left\lceil\frac{\max\limits_i(pT_{ji})}{1440}\right\rceil - \left\lceil\frac{E_j}{1440}\right\rceil \right)\right] \cdot H + \sum_{j|P_j = LP} \left\lfloor \frac{t^e_j}{\sigma} \right\rfloor \cdot H
	\end{split}
\end{equation}

\section{アルゴリズム}
提案解法のアルゴリズムについて述べる．
第１段階のアルゴリズムを以下に示す．

\begin{description}
	\item[Step0] DEで用いる個体数などのパラメーターの初期設定を行い，
	             問題例データを読み込む．
	\item[Step1] 作業間の資源を割り当てる順番と各作業に割り当てる資源に対応する実数値順列を有する初期個体
	             を個体数分生成する．
	             この個体群に対してDEが適用される．
							 初期個体は，ランダムおよびヒューリスティックに生成される．
	\item[Step2] 各個体に対する目的関数$F^{\prime}$の値を求める．
	\item[Step3] 個体群に対してDEの突然変異と交叉を行う．
	             目的関数$F^{\prime}$の値がより小さい個体を選択し，
							 次世代での進化に用いる．
  \item[Step4] 終了条件（試行回数が規定回数を満たす）を満たしている場合，
	             第１段階のアルゴリズムを終了し，第２段階へと移行する．
							 満たしていない場合，Step2に戻る．
\end{description}

次に，第２段階のアルゴリズムを以下に示す．

\begin{description}
	\item[Step0] 第１段階で得られた個体群から
	             目的関数$F^{\prime}$の値が最小である個体の中で，
	             すべての制約を満たす個体が存在する場合，
							 Step5に進む．
							 そうでない場合，
							 目的関数$F^{\prime}$の値が最小の個体をすべて選択して
							 Step1に進む．
	\item[Step1] 各個体において，
	             休日出勤が可能な全ての作業者に対して，
							 希望する時間帯に残業を割り当てる．
							 各個体に対するスケジュールを作成し直し，
							 目的関数$F^{\prime}$の値を求める．
	             このとき，すべての制約を満たす個体が存在する場合，
							 Step5に進む．
							 そうでない場合，Step2に進む．
	\item[Step2] 各個体において，
	             納期内に完了しないHPジョブを担当する作業者に対して，
	             残業時間を最小化しつつ，
	             作業者の希望に沿うよう平日の残業を割り当てる．
	\item[Step3] 各個体に対するスケジュールを作成し直し，
	             目的関数$F^{\prime}$の値を求める．
	\item[Step4] 終了条件（試行回数が規定回数に達するかまたは各個体がすべての制約を満たす）を満たしている場合，
	             Step5に進む．
							 満たしていない場合，Step2に戻る．
	\item[Step5] すべての制約を満たし，
	             目的関数$F^{\prime}$の値が最小である個体を最終解とし，
	             第２段階のアルゴリズムを終了する．
							 すべての制約を満たす個体がなければ，
							 目的関数$F^{\prime}$の値が最小である個体を最終解として
							 第２段階のアルゴリズムを終了する．
\end{description}
Step2の各個体に対して行う内容を次節で詳しく説明する．

\section{平日での残業の割り当て}
納期内に完了しないHPジョブを担当する作業者に対して，
残業時間を最小化しつつ，
作業者の希望に沿うよう平日の残業を割り当てるアルゴリズムについて説明する．
このアルゴリズムを疑似コードとしてAlgorithm 1に示す．
このアルゴリズムでは，
個体における納期内に完了しないHPジョブの作業をランダムに選択し，
さらに，その作業が行われる平日の日付をランダムに選択する．
そして，その作業を担当する作業者に対して，
その日付のシフトをあらかじめ定められた時間分増やす．

前節の第２段階アルゴリズムに示したように，
上記の試行を試行回数が規定回数を満たすか，
または各個体がすべての制約を満たすまで繰り返し行う．
目的関数$F^{\prime}$の第3項で，
シフトが作業者の希望に沿っていない場合に
ペナルティ係数$H$を乗じた数値を加えているため，
目的関数$F^{\prime}$の値が最小であることは
シフトが作業者の希望にできるだけ沿っていることを意味する．

\begin{algorithm}
	\caption{第２段階のアルゴリズムのStep2}
	\label{alg1}
	\begin{algorithmic}[1]
		\setlength{\baselineskip}{19pt}
		\REQUIRE 　\\
				$x$：個体 \\
				$ASG$：各試行で割り当てる残業時間
    \ENSURE 　\\
				スケジュール修正後の個体
		\FOR{$j = 1,2, \cdots ,N_j$}
     \STATE $t_j \leftarrow$ 個体$x$におけるジョブ$j$の納期からの遅延期間
		 \IF{$t_j > 0$ \AND $P_j = HP $}
		  \STATE ジョブ$j$の作業$O_{ji}$をランダムに選択する．
			\STATE $w \leftarrow O_{ji}$を実行する作業者
		  \STATE 日付$d \in D_{ji} \cap (D \setminus HD)$をランダムに選択する．
			\IF{$wt^w_d \leq 960$}
			 \STATE $wt^w_d \leftarrow wt^w_d + ASG$
			\ENDIF
		 \ENDIF
		\ENDFOR
	\RETURN $x$
	\end{algorithmic}
\end{algorithm}

\chapter{実験結果と考察}
本章では，第５章での提案解法を問題例に適用し，
その結果に基づいて，先行研究との比較を行い，
提案解法の有効性を確かめる．
また，その結果に対する考察について述べる．
提案解法と先行研究における解法IDEは
プログラミング言語C++17で実装し，
実験はIntel Core TM i7-1165G7と16.0GBのRAMを搭載した計算機で行った．

\section{問題例}
本実験では，提案解法により，
表(6.1)で示す２つの異なる規模の生産システム（インスタンス）のスケジューリングを行う．
インスタンス1,2は先行研究で用いられているインスタンスであり，
インスタンス1は実際の生産現場を調査して得たデータを基に
生成されたインスタンスである．
インスタンス1での作業者が希望する残業時間は調査の対象外であるので，
ここでは適切なスケジューリングが行えるように考慮しつつ，
ランダムに設定されている．
インスタンス2は大規模のインスタンスであり，
納期や作業者が希望する残業時間などの
すべてのパラメーターは適切なスケジューリングが行えるように考慮しつつ，
ランダムに設定されている．

\begin{table}[H]
\centering
  \caption{実験用インスタンス}
  \begin{tabular}{lcccc}  \hline
    インスタンス  & ジョブの数 & 作業の数 & 機械の数 & 作業者の人数 \\ \hline
		インスタンス1 & 3         & 15       & 2       & 10 \\
		インスタンス2 & 11        & 159      & 10      & 20 \\  \hline
  \end{tabular}
\end{table}

\section{結果}
提案解法で用いるパラメーターは，
実験により，良い目的関数値が得られやすく，
実行時間ができるだけ早い結果が得られたパラメーターを用いる．
提案解法の第１段階のアルゴリズムに関するパラメーターにおいて，
目的関数$F^{\prime}$におけるペナルティ係数$H$を$H = 10^4$とし，
差分進化に関するパラメーターについて，
集団サイズ$NP$を$NP = 500$，スケーリングファクター$SF$を$SF = 0.7$，
交叉率$CR$を$CR = 0.2$，世代数（差分進化の規定回数）$GEN$を$GEN = 10$とする．
また，第２段階のアルゴリズムに関するパラメーターにおいて，
平日での残業の割り当ての規定回数$maxIter$を$maxIter = 100$，
各試行で割り当てる残業時間$ASG$を$ASG = 30$とする．
上記のパラメーターの下で，
提案解法でインスタンス1,2に対して
スケジューリングを行った結果を表(6.2)に示す．
また，先行研究における解法IDEでインスタンス1,2に対して
スケジューリングを行った結果を表(6.3)に示す．

\begin{table}[H]
\centering
  \caption{各インスタンスの実験結果（提案解法）}
  \begin{tabular}{lcccc}  \hline
    インスタンス  & $F^{\prime}$              & 残業時間 & 実行時間 \\ \hline
		インスタンス1 & 6.00 $\times 10^5$ + 2    & 240      & 20.79   \\
		インスタンス2 & 61                        & 5730     & 250.44  \\ \hline
  \end{tabular}
\end{table}

\begin{table}[H]
\centering
  \caption{各インスタンスの実験結果（IDE）}
  \begin{tabular}{lcccc}  \hline
    インスタンス  & $F^{\prime}$              & 残業時間 & 実行時間 \\ \hline
		インスタンス1 & 2.1 $\times 10^6$ + 2     & 240      & 14.10   \\
		インスタンス2 & 9.00 $\times 10^5$ + 61   & 5520     & 171.33  \\ \hline
  \end{tabular}
\end{table}

\section{考察}
提案解法によって得られた目的関数値と
IDEによって得られた目的関数値では，
提案解法の方がより小さい値を示しており，
このことは提案解法で作成したシフトの方が
作業者の希望にできるだけ沿っていることを意味する．
そのため，作業者の希望に沿うシフトを作成するという観点では，
提案解法の方が優れている．
また，ペナルティ係数$H$を乗じた数値を除いた数値が
先行研究と同じであるため，
提案解法は作業者の希望に沿うシフトを作成しつつ，
先行研究と同様に，
LPジョブの納期からの遅延日数を最小化するとともに，
HPジョブを納期内に完了させることができている．

残業時間に関しては先行研究の方が短く，
残業時間の最小化という観点では，
先行研究の方が優れている．
ただし，提案解法は残業時間が作業者の希望に沿うシフトを優先するため，
残業時間の最小化と作業者の希望に沿うことを両立することは難しく，
この点が提案解法における課題点となる．

実行時間に関しては先行研究の方が早いが，
提案解法では先行研究と同様に
LPジョブの納期からの遅延日数を最小化するとともに，
HPジョブを納期内に完了させた上で
作業者の希望に沿うシフトを作成するため，
この点を考慮すると，
IDEと提案解法に大きな差はないと考えられる．

以上の考察から，
先行研究における解法IDEの第２段階で，
作業者が希望する残業時間に基づいたスケジューリングを導入することで，
残業時間が作業者の希望に沿うシフトを作成できることが分かった．
提案解法のように残業時間が作業者の希望に沿うことを優先すると，
残業時間をより短くできるシフトが作成される可能性があるため，
残業時間の最小化という観点で改善の余地があることが明らかになった．

\chapter{結言}
本研究では，機械と作業者の２つの資源で構成され，
各作業が機械と作業者を必要とする作業と作業者のみを必要とする作業で行われる生産現場を対象とし，
作業間の順序制約，ジョブの優先度，資源制約，機械および作業者の柔軟性，
メンテナンスなどの資源の利用不可期間といった制約を考慮したFJSPに対する解法として，
先行研究で提案されているIDEを改良し，
新しい解法を提案した．
この提案解法では，先行研究では考慮されていなかった，
作業者が希望する残業時間に基づいてスケジューリングを行うことで，
作業者の希望に沿ってシフトを決定することを試みた．

先行研究との比較をしつつ，提案解法の有効性を検証するため，
実際の生産現場を調査して得たデータを基に生成されたインスタンスと
大規模のインスタンスの
２つの先行研究で用いられているインスタンスに対してスケジューリングを行った．
その結果として，
提案解法は先行研究における解法IDEと大きな差がない実行時間で，
作業者の希望に沿うシフトを作成しつつ，
先行研究と同様に，
LPジョブの納期からの遅延日数を最小化するとともに，
HPジョブを納期内に完了させることができていることが分かった．

今後の展望として，
残業時間の最小化という観点での課題について議論する．
第6.3節で指摘したように，
提案解法は残業時間が作業者の希望に沿うことを優先するため，
残業時間をより短くできるシフトが作成される可能性がある．
しかし，残業時間をより短くしようとすると
残業時間が作業者の希望に沿うことができなくなる可能性があり，
残業時間の最小化と作業者の希望に沿うことを両立することは難しい．
その原因として，
提案解法の第１段階で各作業に割り当てる最適な資源を求めるため，
第２段階の作業者が希望する残業時間に基づいたスケジューリングを行うときに，
対象となる作業者は限られ，
残業時間が作業者の希望に沿うことを満たすかどうかは
その作業者が希望する残業時間に依存する．
この依存関係を解消するために考えられる解法として，
第１段階で作業者のシフトも考慮する解法が挙げられるが，
この解法では差分進化における探索空間$S$が過度に広くなり，
効率的にスケジューリングを行うことが難しく，
実行時間が長くなる．
そのため，ここでの課題を解決するには，
作業者のシフトも考慮しつつ，
作業間の資源を割り当てる最適な順番と
各作業に割り当てる最適な資源を効率的に求める解法を考える必要がある．

\acknowledgement % 謝辞
本研究を行うにあたり，研究課題の設定や研究に対する姿勢，本報告書の作成に
至るまで，全ての面で丁寧なご指導を頂きました，本学情報工学・人間科学系 
飯間等准教授に厚く御礼申し上げます．
本報告書執筆にあたり貴重な助言を多数頂きました，本学情報工学専攻
 木村先輩，米谷先輩，森下先輩，寺村先輩，情報工学課程 吉本君を
はじめとする，情報知能システム研究室の皆さん，学生生活を通じて著者の支えとなった
家族や友人に深く感謝致します．

% 参考文献
\bibliographystyle{kit-is} % 文献スタイルファイル
\bibliography{sample_b} % 文献データベース

\end{document}